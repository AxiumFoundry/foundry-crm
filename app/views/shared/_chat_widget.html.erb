<div data-controller="chat-widget">
  <% conversation = current_chat_conversation %>

  <!-- Toggle Button -->
  <button
    data-chat-widget-target="toggle"
    data-action="click->chat-widget#toggleWidget"
    class="fixed bottom-6 right-6 z-50 w-14 h-14 bg-accent hover:bg-primary-dark text-cream rounded-full shadow-lg flex items-center justify-center transition-base cursor-pointer animate-bounce hover:animate-none"
    aria-label="Open chat">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
    </svg>
  </button>

  <!-- Chat Window -->
  <div
    data-chat-widget-target="window"
    class="fixed bottom-24 right-6 z-50 w-[22rem] h-[32rem] bg-navy-light/80 backdrop-blur-xl border border-gray-700 rounded-lg shadow-2xl flex flex-col overflow-hidden origin-bottom-right transition-all duration-300 ease-out scale-0 opacity-0 pointer-events-none">

    <!-- Header -->
    <div class="bg-navy-lighter border-b border-gray-700 px-4 py-3 flex justify-between items-center shrink-0">
      <div>
        <h3 class="text-cream font-semibold text-sm">Axium Foundry</h3>
        <span class="text-xs text-gray-400">AI Assistant</span>
      </div>
      <button
        data-action="click->chat-widget#closeWidget"
        class="text-gray-400 hover:text-cream transition-base"
        aria-label="Close chat">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Stream subscription -->
    <div id="chat-stream">
      <% if conversation %>
        <%= turbo_stream_from conversation %>
      <% end %>
    </div>

    <!-- Messages -->
    <div
      id="messages"
      data-chat-widget-target="messages"
      class="flex-1 overflow-y-auto p-4 space-y-3 min-h-0">
      <!-- Welcome message -->
      <div data-role="assistant">
        <div class="max-w-[85%] bg-navy-lighter rounded-lg rounded-tl-none px-3 py-2">
          <p class="text-cream text-sm">Hi! I'm Axium Foundry's AI assistant. Ask me about our services, capabilities, or how we can help your startup ship faster.</p>
        </div>
      </div>

      <% if conversation %>
        <%= render partial: "chat_messages/message", collection: conversation.chat_messages.ordered, as: :message %>
      <% end %>
    </div>

    <!-- Input Form -->
    <%= render "chat_messages/form", show_human_request: conversation.present? %>
  </div>
</div>
